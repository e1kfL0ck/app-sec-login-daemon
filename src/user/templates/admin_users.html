{% extends "base.html" %}

{% block content %}
<div class="max-w-5xl mx-auto">
  <div class="mb-6 flex justify-between items-center">
    <a href="{{ url_for('dashboard') }}" class="text-indigo-600 hover:text-indigo-800 font-semibold">‚Üê Back to
      Dashboard</a>
    <h1 class="text-3xl font-bold text-gray-900">User Management</h1>
  </div>

  <div class="bg-white rounded-lg shadow-lg border border-gray-200">
    <div class="p-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-800">All Users</h2>
      <p class="text-sm text-gray-600">Click a user to view/manage their profile and posts.</p>
    </div>

    <div class="overflow-x-auto">
      <table class="min-w-full divide-y divide-gray-200">
        <thead class="bg-gray-50">
          <tr>
            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Email</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Role</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Activated</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
            <th class="px-4 py-3 text-left text-xs font-semibold text-gray-600 uppercase tracking-wider">Created</th>
            <th class="px-4 py-3"></th>
          </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-100">
          {% for u in users %}
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-3 text-sm font-semibold text-gray-800">{{ u['email'] }}</td>
            <td class="px-4 py-3 text-sm text-gray-700">{{ u['role']|capitalize }}</td>
            <td class="px-4 py-3 text-sm text-gray-700">{{ 'Yes' if u['activated'] else 'No' }}</td>
            <td class="px-4 py-3 text-sm">
              {% if u['disabled_by_admin'] %}
              <span class="px-2 py-1 rounded-full text-xs font-semibold bg-red-100 text-red-700">Disabled by
                admin</span>
              {% elif u['disabled'] %}
              <span class="px-2 py-1 rounded-full text-xs font-semibold bg-amber-100 text-amber-700">Disabled</span>
              {% else %}
              <span class="px-2 py-1 rounded-full text-xs font-semibold bg-green-100 text-green-700">Active</span>
              {% endif %}
            </td>
            <td class="px-4 py-3 text-sm text-gray-700">{{ u['created_at'].split('T')[0] if u['created_at'] else 'N/A'
              }}</td>
            <td class="px-4 py-3 text-right">
              <a href="{{ url_for('user.admin_view_profile', target_user_id=u['id']) }}"
                class="inline-block px-3 py-2 bg-indigo-600 text-white rounded-lg text-sm font-semibold hover:bg-indigo-700 transition">Manage</a>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}